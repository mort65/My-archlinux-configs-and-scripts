#!/bin/bash

if [ "${#}" -gt 1 ]; then
  printf "Too many arguments\n"
  exit 1
fi

NUM=$(/usr/bin/nproc)

for (( i=1; i<="${NUM}"; i++ ))
do  
   TEMP[i]=$(/usr/bin/sensors | /usr/bin/sed -n -e "s/^Core $((${i} - 1)):[^0-9]*//p" | /usr/bin/sed -n -e "s/°C.*$//p")
done

if [ -n "$1" ]; then
  if [[ $1 =~ ^-?[1-${#TEMP[@]}]$ ]]; then
    VAL=TEMP[${1#"-"}]
    printf "${!VAL}°C\n"
    exit 0
  elif [[ $1 =~ ^-?-?[Mm][Ii][Nn]$ ]]; then
    MIN="${TEMP[1]}"
    VAL=""
    for (( i=2; i<="${NUM}"; i++ ))
      do
        VAL=TEMP[i]
        if (( $(echo "$MIN > ${!VAL}" | /usr/bin/bc -l) )); then
          MIN=${!VAL}
        fi
    done
    printf "$MIN°C\n"
    exit 0
  elif [[ $1 =~ ^-?-?[Mm][Aa][Xx]$ ]]; then
    MAX="${TEMP[1]}"
    VAL=""
    for (( i=2; i<="${NUM}"; i++ ))
      do
        VAL=TEMP[i]
        if (( $(echo "$MAX < ${!VAL}" | /usr/bin/bc -l) )); then
          MAX=${!VAL}
        fi
    done
    printf "$MAX°C\n"
    exit 0
  elif [[ $1 =~ ^-?-?[Aa][Vv][Gg]$ ]]; then
    SUM="${TEMP[1]}"
    AVG=""
    VAL=""
    for (( i=2; i<="${NUM}"; i++ ))
      do
        VAL=TEMP[i]
        SUM=$(echo "$SUM + ${!VAL}" | /usr/bin/bc -l)
    done
    AVG=$(echo "$SUM/4" | /usr/bin/bc -l)
    printf "%.1f°C\n" $AVG
    exit 0
else
  printf "Invalid argument '$1'\n"
  exit 1
  fi
fi

for (( i=1; i<="${NUM}"; i++ ))
  do
    printf "${TEMP[i]}°C\n"
done

exit 0
