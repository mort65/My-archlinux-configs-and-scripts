#!/bin/bash

USERNAME=${SUDO_USER:-$(id -u -n)}
HOMEDIR="/home/$USERNAME"
ofile="Archbackup.tar.gz"
opath="/run/media/$USERNAME/SP-PHD-U1"
odir="ArchBackup"

if ! grep -qsw "$opath" /proc/mounts; then
  echo "NO DRIVE FOUND! Please make sure external hard drive is connected." ; exit 1 
fi

echo -e "\n\nTask Started!\n\n$"
#if [ -f "${opath}/${ofile}"]; then
#	rm -rf "$opath"/"$ofile"
#fi
echo -e "\n\nBackup Started!\n\n"
/usr/bin/rsync -aAXv --delete --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found","/run/media/$USERNAME/*/","$HOMEDIR/.cache/*/","home/$USERNAME/VirtualBox VMs/*","home/$USERNAME/VirtualBox VMs/*/","$HOMEDIR/.PlayOnLinux/*/","$HOMEDIR/.PlayOnLinux/*","$HOMEDIR/.PlayOnLinux/","$HOMEDIR/Calibre Library/*/","$HOMEDIR/Calibre Library/*","/var/cache/*/","/var/cache/*","*/PlayOnLinux\'s virtual drives","$HOMEDIR/Apps/Dictionarys/GoldenDict/*/","$HOMEDIR/Apps/Dictionarys/GoldenDict/*","$HOMEDIR/.local/share/Steam/steamapps/common/*/","$HOMEDIR/.local/share/Steam/steamapps/common/*","$HOMEDIR/Apps/*/","$HOMEDIR/Apps/*","$HOMEDIR/Music/*/","$HOMEDIR/Music/*","$HOMEDIR/Documents/*/","$HOMEDIR/Documents/*","$HOMEDIR/Downloads/*/","$HOMEDIR/Downloads/*","$HOMEDIR/Videos/*/","$HOMEDIR/Videos/*","$HOMEDIR/Pictures/*/","$HOMEDIR/Pictures/*"} --bwlimit=10000 / "${opath}/${odir}/"
#echo -e "\n\nBackup Completed!\n\n"
#tar -zcvf "${opath}/${ofile}" "${opath}/${odir}/"
#echo -e "\n\nCompressing Completed!\n\n"
#rm -rf "${opath}/${odir}/"
/usr/bin/sync
echo -e "\n\nTask Completed!\n\n"
