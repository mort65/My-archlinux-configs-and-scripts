#!/bin/bash

# Colors
red=`tput setaf 1`
green=`tput setaf 2`
reset=`tput sgr0`

USERNAME=${SUDO_USER:-$(id -u -n)}
HOMEDIR="/home/$USERNAME"

ofile="Arch-MO-Backup.tar.gz"
opath="/run/media/$USERNAME/SP-PHD-U1"
odir="ArchMoBackup"


if ! grep -qsw "$opath" /proc/mounts; then
  echo "NO DRIVE FOUND! Please make sure external hard drive is connected." ; exit 1 
fi

/usr/bin/mkdir -p "${opath}/${odir}/"
/usr/bin/mkdir -p "${opath}/Backups/Linux"

/usr/bin/rm -f "${opath}/Backups/Linux/log.txt"

date >> "${opath}/Backups/Linux/log.txt"

echo -e "\n\nTask Started!\n\n" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"


if [ -f "${opath}/Backups/Linux/${ofile}" ]; then
	 /usr/bin/rm -rf "$opath"/Backups/Linux/"$ofile" && echo -e "\n\nPrevious Backup Deleted!\n\n" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"
fi



# "$_" means: first argument from last command
/usr/bin/mkdir -p $HOMEDIR/Apps/Usefull\ Commands/Arch/Scripts/bin/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/bin/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Apps/Usefull\ Commands/Arch/Scripts/.script/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/.script/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Apps/Usefull\ Commands/Arch/note/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/.note/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Apps/Usefull\ Commands/Gentoo/note/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/VirtualBox\ VMs/share/Gentoo/Notes/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Dropbox/Configs/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/Apps/Usefull Commands/Arch/Configs/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Dropbox/Scripts/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/Apps/Usefull Commands/Arch/Scripts/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Dropbox/Notes/Linux/Arch/ && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/Apps/Usefull Commands/Arch/" "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/mkdir -p $HOMEDIR/Dropbox/Notes/Programming/Javascript/ && /usr/bin/cp -f "$HOMEDIR/Apps/Programming/Javascript/Javascript Notes.txt"  "$_" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

echo -e "\n\nBackup Started!\n\n"
/usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/Apps/Usefull Commands/" "${opath}/${odir}/Usefull Commands/" && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/Apps/Programming/" "${opath}/${odir}/Programming/" && /usr/bin/rsync -aAXv --bwlimit=10000 "$HOMEDIR/KeePass/" "${opath}/${odir}/KeePass/" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"
echo -e "\n\nBackup Completed!\n\n" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"
echo -e "\n\nCompressing Started!\n\n" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"
/usr/bin/tar -zcvf "${opath}/Backups/Linux/${ofile}" "${opath}/${odir}/" && echo -e "\n\nCompressing Completed!\n\n" && /usr/bin/rm -rf "${opath}/${odir}/" && echo -e "\n\nTemp Directory Removed!\n\n" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"

/usr/bin/sync

echo -e "\n\nTask Completed!\n\n" 2>&1 | /usr/bin/tee -a "${opath}/Backups/Linux/log.txt"
